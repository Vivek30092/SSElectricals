{% extends "admin/base_site.html" %}
{% load static %}

{% block extrastyle %}
<style>
    .filter-form {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 5px;
        margin-bottom: 20px;
    }
    .filter-form label {
        margin-right: 10px;
        font-weight: bold;
    }
    .filter-form select,
    .filter-form input {
        margin-right: 15px;
        padding: 5px 10px;
    }
    .log-table {
        width: 100%;
        background: white;
        border-collapse: collapse;
    }
    .log-table th {
        background: #417690;
        color: white;
        padding: 12px;
        text-align: left;
        position: sticky;
        top: 0;
    }
    .log-table td {
        padding: 10px 12px;
        border-bottom: 1px solid #ddd;
    }
    .log-table tr:hover {
        background: #f8f9fa;
    }
    .badge {
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 11px;
        font-weight: bold;
    }
    .badge-create { background: #d4edda; color: #155724; }
    .badge-update { background: #cce5ff; color: #004085; }
    .badge-delete { background: #f8d7da; color: #721c24; }
    .badge-login { background: #d1ecf1; color: #0c5460; }
    .badge-logout { background: #fff3cd; color: #856404; }

    .pagination {
        margin-top: 20px;
        text-align: center;
    }
    .pagination a {
        padding: 8px 12px;
        margin: 0 5px;
        background: #417690;
        color: white;
        text-decoration: none;
        border-radius: 4px;
    }
    .pagination a:hover {
        background: #2e5766;
    }
    .pagination .current {
        padding: 8px 12px;
        margin: 0 5px;
        background: #f8f9fa;
        border: 1px solid #417690;
        border-radius: 4px;
    }
</style>
{% endblock %}

{% block content %}
<h1>Admin Activity Log</h1>

<form method="get" class="filter-form">
    <label>Action:</label>
    <select name="action">
        <option value="">All</option>
        {% for value, label in action_choices %}
        <option value="{{ value }}" {% if request.GET.action == value %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
    </select>

    <label>Module:</label>
    <select name="module">
        <option value="">All</option>
        {% for value, label in module_choices %}
        <option value="{{ value }}" {% if request.GET.module == value %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
    </select>

    <label>Admin:</label>
    <select name="admin">
        <option value="">All</option>
        {% for admin_user in admins %}
        <option value="{{ admin_user.id }}" {% if request.GET.admin == admin_user.id|stringformat:"s" %}selected{% endif %}>
            {{ admin_user.username }}
        </option>
        {% endfor %}
    </select>

    <label>Search:</label>
    <input type="text" name="search" placeholder="Search description..." value="{{ request.GET.search|default:'' }}">

    <button type="submit" style="padding: 5px 15px; background: #417690; color: white; border: none; border-radius: 4px; cursor: pointer;">
        Filter
    </button>
    <a href="{% url 'admin_activity_log' %}" style="padding: 5px 15px; background: #6c757d; color: white; text-decoration: none; border-radius: 4px; margin-left: 10px;">
        Clear
    </a>
</form>

<table class="log-table">
    <thead>
        <tr>
            <th>Timestamp</th>
            <th>Admin</th>
            <th>Action</th>
            <th>Module</th>
            <th>Description</th>
            <th>IP Address</th>
        </tr>
    </thead>
    <tbody>
        {% for log in page_obj %}
        <tr>
            <td>{{ log.timestamp|date:"Y-m-d H:i:s" }}</td>
            <td><strong>{{ log.admin.username }}</strong></td>
            <td><span class="badge badge-{{ log.action|lower }}">{{ log.get_action_display }}</span></td>
            <td>{{ log.get_module_display }}</td>
            <td>{{ log.description }}</td>
            <td>{{ log.ip_address }}</td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="6" style="text-align: center; padding: 30px;">No activity logs found</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<div class="pagination">
    {% if page_obj.has_previous %}
    <a href="?page=1&action={{ request.GET.action }}&module={{ request.GET.module }}&admin={{ request.GET.admin }}&search={{ request.GET.search }}">First</a>
    <a href="?page={{ page_obj.previous_page_number }}&action={{ request.GET.action }}&module={{ request.GET.module }}&admin={{ request.GET.admin }}&search={{ request.GET.search }}">Previous</a>
    {% endif %}

    <span class="current">
        Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
    </span>

    {% if page_obj.has_next %}
    <a href="?page={{ page_obj.next_page_number }}&action={{ request.GET.action }}&module={{ request.GET.module }}&admin={{ request.GET.admin }}&search={{ request.GET.search }}">Next</a>
    <a href="?page={{ page_obj.paginator.num_pages }}&action={{ request.GET.action }}&module={{ request.GET.module }}&admin={{ request.GET.admin }}&search={{ request.GET.search }}">Last</a>
    {% endif %}
</div>

{% endblock %}
